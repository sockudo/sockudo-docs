<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 480" font-family="ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace" font-size="13">
  <style>
    .box { rx: 10; ry: 10; stroke-width: 1.5; }
    .label { text-anchor: middle; dominant-baseline: central; }
    .edge-label { text-anchor: middle; dominant-baseline: central; font-size: 11; }
    .arrow { stroke-width: 1.5; fill: none; marker-end: url(#ah); }
    .arrow-both { stroke-width: 1.5; fill: none; marker-start: url(#ah-rev); marker-end: url(#ah); }
    .dashed { stroke-dasharray: 6 3; }
    @media (prefers-color-scheme: dark) {
      .box-client  { fill: #1e3a5f; stroke: #38bdf8; }
      .box-lb      { fill: #3b2f1a; stroke: #fbbf24; }
      .box-server  { fill: #1a3328; stroke: #34d399; }
      .box-infra   { fill: #3b1f5e; stroke: #a78bfa; }
      .box-metrics { fill: #3b1a1a; stroke: #f87171; }
      .group-bg    { fill: #0f172a; stroke: #334155; opacity: 0.5; }
      .label       { fill: #e2e8f0; }
      .label-dim   { fill: #94a3b8; }
      .edge-label  { fill: #94a3b8; }
      .arrow       { stroke: #64748b; }
      .arrow-both  { stroke: #64748b; }
      .arrow-head  { fill: #64748b; }
    }
    @media (prefers-color-scheme: light) {
      .box-client  { fill: #eff6ff; stroke: #3b82f6; }
      .box-lb      { fill: #fefce8; stroke: #eab308; }
      .box-server  { fill: #ecfdf5; stroke: #10b981; }
      .box-infra   { fill: #f5f3ff; stroke: #8b5cf6; }
      .box-metrics { fill: #fef2f2; stroke: #ef4444; }
      .group-bg    { fill: #f8fafc; stroke: #e2e8f0; opacity: 0.6; }
      .label       { fill: #1e293b; }
      .label-dim   { fill: #64748b; }
      .edge-label  { fill: #64748b; }
      .arrow       { stroke: #94a3b8; }
      .arrow-both  { stroke: #94a3b8; }
      .arrow-head  { fill: #94a3b8; }
    }
  </style>
  <defs>
    <marker id="ah" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" class="arrow-head"/>
    </marker>
    <marker id="ah-rev" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" class="arrow-head"/>
    </marker>
  </defs>

  <!-- Clients -->
  <rect class="box box-client" x="30" y="30" width="120" height="44"/>
  <text class="label" x="90" y="52" font-weight="600">Client A</text>

  <rect class="box box-client" x="30" y="90" width="120" height="44"/>
  <text class="label" x="90" y="112" font-weight="600">Client B</text>

  <rect class="box box-client" x="30" y="150" width="120" height="44"/>
  <text class="label" x="90" y="172" font-weight="600">Client C</text>

  <!-- Load Balancer -->
  <rect class="box box-lb" x="220" y="70" width="150" height="80"/>
  <text class="label" x="295" y="100" font-weight="700" font-size="14">Load Balancer</text>
  <text class="label label-dim" x="295" y="120" font-size="10">sticky sessions</text>

  <!-- Arrows: clients -> LB -->
  <line class="arrow" x1="150" y1="52" x2="220" y2="90"/>
  <line class="arrow" x1="150" y1="112" x2="220" y2="110"/>
  <line class="arrow" x1="150" y1="172" x2="220" y2="130"/>

  <!-- Sockudo nodes group -->
  <rect class="box group-bg" x="430" y="20" width="200" height="270" rx="14" ry="14"/>
  <text class="label label-dim" x="530" y="42" font-size="10" font-weight="600" letter-spacing="1">SOCKUDO CLUSTER</text>

  <rect class="box box-server" x="455" y="58" width="150" height="50"/>
  <text class="label" x="530" y="76" font-weight="700">Node A</text>
  <text class="label label-dim" x="530" y="94" font-size="10">local sockets</text>

  <rect class="box box-server" x="455" y="128" width="150" height="50"/>
  <text class="label" x="530" y="146" font-weight="700">Node B</text>
  <text class="label label-dim" x="530" y="164" font-size="10">local sockets</text>

  <rect class="box box-server" x="455" y="198" width="150" height="50"/>
  <text class="label" x="530" y="216" font-weight="700">Node C</text>
  <text class="label label-dim" x="530" y="234" font-size="10">local sockets</text>

  <!-- Arrows: LB -> nodes -->
  <line class="arrow" x1="370" y1="90" x2="455" y2="83"/>
  <line class="arrow" x1="370" y1="110" x2="455" y2="153"/>
  <line class="arrow" x1="370" y1="130" x2="455" y2="223"/>

  <!-- Pub/Sub backend -->
  <rect class="box box-infra" x="680" y="90" width="120" height="120"/>
  <text class="label" x="740" y="130" font-weight="700" font-size="14">Redis</text>
  <text class="label" x="740" y="150" font-size="14">/ NATS</text>
  <text class="label label-dim" x="740" y="175" font-size="10">pub/sub</text>

  <!-- Arrows: nodes <-> redis -->
  <line class="arrow-both" x1="605" y1="83" x2="680" y2="130"/>
  <line class="arrow-both" x1="605" y1="153" x2="680" y2="150"/>
  <line class="arrow-both" x1="605" y1="223" x2="680" y2="170"/>

  <!-- Three channels label -->
  <text class="edge-label" x="650" y="65" font-size="10">#broadcast</text>
  <text class="edge-label" x="650" y="78" font-size="10">#requests</text>
  <text class="edge-label" x="650" y="91" font-size="10">#responses</text>

  <!-- Metrics -->
  <rect class="box box-metrics" x="455" y="310" width="150" height="50"/>
  <text class="label" x="530" y="328" font-weight="700">Prometheus</text>
  <text class="label label-dim" x="530" y="346" font-size="10">:9601/metrics</text>

  <line class="arrow dashed" x1="530" y1="248" x2="530" y2="310"/>

  <!-- Flow description boxes -->
  <rect class="box group-bg" x="30" y="370" width="760" height="90" rx="10" ry="10"/>
  <text class="label" x="410" y="395" font-weight="700" font-size="13">How cross-node broadcasting works</text>
  <text class="label label-dim" x="410" y="418" font-size="11">1. Client sends event to Node A</text>
  <text class="label label-dim" x="410" y="435" font-size="11">2. Node A delivers to local subscribers, then publishes to #broadcast channel</text>
  <text class="label label-dim" x="410" y="452" font-size="11">3. Nodes B and C receive from #broadcast, deliver to their local subscribers</text>
</svg>
